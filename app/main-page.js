var Physics = require("nativescript-physics-js");
var accService = require("native-script-accelerometer");
var gravity_scale = 0.003;
var init = false;
var gameEnded = false;
var gravity;
var page;
function pageLoaded(args) {
    if (init) {
        return;
    }
    init = true;
    // Get references to container and meta-info views
    page = args.object;
    var container = page.getViewById("container");
    var metaText = page.getViewById("meta");
    // Create physics world and configure NS renderer
    var world = Physics({ sleepDisabled: true });
    world.add(Physics.renderer('ns', {
        container: container,
        metaText: metaText,
        meta: true
    }));
    addWall(world, 5, 150, 10, 300);
    addWall(world, 295, 150, 10, 300);
    addWall(world, 150, 5, 300, 10);
    addWall(world, 150, 295, 300, 10);
    addWall(world, 150, 225, 10, 150); // Middle
    addTarget(world, 225, 225);
    addBall(world, 50, 250);
    var query = Physics.query({
        $or: [
            { bodyA: { label: 'ball' }, bodyB: { label: 'target' } },
            { bodyB: { label: 'target' }, bodyA: { label: 'ball' } }
        ]
    });
    world.on('collisions:detected', function (data, e) {
        // find the first collision that matches the query
        var found = Physics.util.find(data.collisions, query);
        if (found) {
            win(world);
        }
    });
    // Add behaviors
    gravity = Physics.behavior('constant-acceleration', { acc: { x: 0, y: 0 } });
    world.add([
        Physics.behavior('edge-collision-detection', { aabb: Physics.aabb(0, 0, 300, 300) }),
        Physics.behavior('body-collision-detection'),
        Physics.behavior('body-impulse-response'),
        Physics.behavior('sweep-prune'),
        gravity
    ]);
    setTimeout(function () {
        try {
            accService.startAccelometerUpdates(gravityUpdate);
        }
        catch (ex) {
            alert(ex.message);
        }
    }, 100);
    // Start ticking...
    world.on('step', function () { world.render(); });
    setInterval(function () { world.step(Date.now()); }, 20);
}
exports.pageLoaded = pageLoaded;
function addWall(world, x, y, width, height, angle) {
    if (angle === void 0) { angle = 0; }
    world.add(Physics.body('rectangle', {
        treatment: 'static',
        x: x,
        y: y,
        width: width,
        height: height,
        angle: angle,
        styles: { color: "orange" }
    }));
}
function addBall(world, x, y) {
    var ball = Physics.body('circle', {
        label: "ball",
        x: x,
        y: y,
        radius: 15,
        styles: { image: "~/images/ball.png" }
    });
    ball.restitution = 0.3;
    world.add(ball);
}
function addTarget(world, x, y) {
    world.add(Physics.body('circle', {
        label: "target",
        treatment: 'static',
        x: x,
        y: y,
        radius: 20,
        styles: { image: "~/images/target.png" }
    }));
}
function gravityUpdate(data) {
    //console.log("data: " + JSON.stringify(data));
    var xAcc = -data.x * gravity_scale;
    var yacc = data.y * gravity_scale;
    gravity.setAcceleration({ x: xAcc, y: yacc });
}
function win(world) {
    if (!gameEnded) {
        gameEnded = true;
        world.pause();
        accService.stopAccelometerUpdates();
        page.getViewById("win").visibility = "visible";
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi1wYWdlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibWFpbi1wYWdlLnRzIl0sIm5hbWVzIjpbInBhZ2VMb2FkZWQiLCJhZGRXYWxsIiwiYWRkQmFsbCIsImFkZFRhcmdldCIsImdyYXZpdHlVcGRhdGUiLCJ3aW4iXSwibWFwcGluZ3MiOiJBQUFBLElBQU8sT0FBTyxXQUFXLHlCQUF5QixDQUFDLENBQUM7QUFFcEQsSUFBTyxVQUFVLFdBQVcsNkJBQTZCLENBQUMsQ0FBQztBQUkzRCxJQUFNLGFBQWEsR0FBRyxLQUFLLENBQUM7QUFFNUIsSUFBSSxJQUFJLEdBQUcsS0FBSyxDQUFDO0FBQ2pCLElBQUksU0FBUyxHQUFHLEtBQUssQ0FBQztBQUV0QixJQUFJLE9BQU8sQ0FBQztBQUNaLElBQUksSUFBVSxDQUFDO0FBQ2Ysb0JBQTJCLElBQUk7SUFDM0JBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBO1FBQ1BBLE1BQU1BLENBQUNBO0lBQ1hBLENBQUNBO0lBQ0RBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBO0lBRVpBLGtEQUFrREE7SUFDbERBLElBQUlBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBO0lBQ25CQSxJQUFJQSxTQUFTQSxHQUFHQSxJQUFJQSxDQUFDQSxXQUFXQSxDQUFDQSxXQUFXQSxDQUFDQSxDQUFDQTtJQUM5Q0EsSUFBSUEsUUFBUUEsR0FBR0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0E7SUFFeENBLGlEQUFpREE7SUFDakRBLElBQUlBLEtBQUtBLEdBQUdBLE9BQU9BLENBQUNBLEVBQUNBLGFBQWFBLEVBQUVBLElBQUlBLEVBQUNBLENBQUNBLENBQUNBO0lBQzNDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxPQUFPQSxDQUFDQSxRQUFRQSxDQUFDQSxJQUFJQSxFQUFFQTtRQUM3QkEsU0FBU0EsRUFBRUEsU0FBU0E7UUFDcEJBLFFBQVFBLEVBQUVBLFFBQVFBO1FBQ2xCQSxJQUFJQSxFQUFFQSxJQUFJQTtLQUNiQSxDQUFDQSxDQUFDQSxDQUFDQTtJQUVKQSxPQUFPQSxDQUFDQSxLQUFLQSxFQUFFQSxDQUFDQSxFQUFFQSxHQUFHQSxFQUFFQSxFQUFFQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFDQTtJQUNoQ0EsT0FBT0EsQ0FBQ0EsS0FBS0EsRUFBRUEsR0FBR0EsRUFBRUEsR0FBR0EsRUFBRUEsRUFBRUEsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7SUFDbENBLE9BQU9BLENBQUNBLEtBQUtBLEVBQUVBLEdBQUdBLEVBQUVBLENBQUNBLEVBQUVBLEdBQUdBLEVBQUVBLEVBQUVBLENBQUNBLENBQUNBO0lBQ2hDQSxPQUFPQSxDQUFDQSxLQUFLQSxFQUFFQSxHQUFHQSxFQUFFQSxHQUFHQSxFQUFFQSxHQUFHQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQTtJQUNsQ0EsT0FBT0EsQ0FBQ0EsS0FBS0EsRUFBRUEsR0FBR0EsRUFBRUEsR0FBR0EsRUFBRUEsRUFBRUEsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsU0FBU0E7SUFFNUNBLFNBQVNBLENBQUNBLEtBQUtBLEVBQUVBLEdBQUdBLEVBQUVBLEdBQUdBLENBQUNBLENBQUNBO0lBQzNCQSxPQUFPQSxDQUFDQSxLQUFLQSxFQUFFQSxFQUFFQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFDQTtJQUV4QkEsSUFBSUEsS0FBS0EsR0FBR0EsT0FBT0EsQ0FBQ0EsS0FBS0EsQ0FBQ0E7UUFDdEJBLEdBQUdBLEVBQUVBO1lBQ0RBLEVBQUVBLEtBQUtBLEVBQUVBLEVBQUVBLEtBQUtBLEVBQUVBLE1BQU1BLEVBQUVBLEVBQUVBLEtBQUtBLEVBQUVBLEVBQUVBLEtBQUtBLEVBQUVBLFFBQVFBLEVBQUVBLEVBQUVBO1lBQ3ZEQSxFQUFFQSxLQUFLQSxFQUFFQSxFQUFFQSxLQUFLQSxFQUFFQSxRQUFRQSxFQUFFQSxFQUFFQSxLQUFLQSxFQUFFQSxFQUFFQSxLQUFLQSxFQUFFQSxNQUFNQSxFQUFFQSxFQUFFQTtTQUM1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