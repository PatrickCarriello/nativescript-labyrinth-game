var Physics = require("nativescript-physics-js");
var accService = require("native-script-accelerometer");
var gravity_scale = 0.003 / 9.81;
var init = false;
var gameEnded = false;
var gravity;
var page;
function pageLoaded(args) {
    if (init) {
        return;
    }
    init = true;
    // Get references to container and meta-info views
    page = args.object;
    var container = page.getViewById("container");
    var metaText = page.getViewById("meta");
    // Create physics world and configure NS renderer
    var world = Physics({ sleepDisabled: true });
    world.add(Physics.renderer('ns', {
        container: container,
        metaText: metaText,
        meta: true
    }));
    addWall(world, 5, 150, 10, 300);
    addWall(world, 295, 150, 10, 300);
    addWall(world, 150, 5, 300, 10);
    addWall(world, 150, 295, 300, 10);
    addWall(world, 150, 225, 10, 150); // Middle
    addTarget(world, 225, 225);
    addBall(world, 50, 250);
    var query = Physics.query({
        $or: [
            { bodyA: { label: 'ball' }, bodyB: { label: 'target' } },
            { bodyB: { label: 'target' }, bodyA: { label: 'ball' } }
        ]
    });
    world.on('collisions:detected', function (data, e) {
        // find the first collision that matches the query
        var found = Physics.util.find(data.collisions, query);
        if (found) {
            win(world);
        }
    });
    // Add behaviors
    gravity = Physics.behavior('constant-acceleration', { acc: { x: 0, y: 0 } });
    world.add([
        Physics.behavior('edge-collision-detection', { aabb: Physics.aabb(0, 0, 300, 300) }),
        Physics.behavior('body-collision-detection'),
        Physics.behavior('body-impulse-response'),
        Physics.behavior('sweep-prune'),
        gravity
    ]);
    setTimeout(function () {
        try {
            accService.startAccelometerUpdates(gravityUpdate);
        }
        catch (ex) {
            alert(ex.message);
        }
    }, 100);
    // Start ticking...
    world.on('step', function () { world.render(); });
    setInterval(function () { world.step(Date.now()); }, 20);
}
exports.pageLoaded = pageLoaded;
function addWall(world, x, y, width, height, angle) {
    if (angle === void 0) { angle = 0; }
    world.add(Physics.body('rectangle', {
        treatment: 'static',
        x: x,
        y: y,
        width: width,
        height: height,
        angle: angle,
        styles: { color: "orange" }
    }));
}
function addBall(world, x, y) {
    var ball = Physics.body('circle', {
        label: "ball",
        x: x,
        y: y,
        radius: 15,
        styles: { image: "~/images/ball.png" }
    });
    ball.restitution = 0.3;
    world.add(ball);
}
function addTarget(world, x, y) {
    world.add(Physics.body('circle', {
        label: "target",
        treatment: 'static',
        x: x,
        y: y,
        radius: 20,
        styles: { image: "~/images/target.png" }
    }));
}
function gravityUpdate(data) {
    //console.log("data: " + JSON.stringify(data));
    var xAcc = -data.x * gravity_scale;
    var yacc = data.y * gravity_scale;
    gravity.setAcceleration({ x: xAcc, y: yacc });
}
function win(world) {
    if (!gameEnded) {
        gameEnded = true;
        world.pause();
        accService.stopAccelometerUpdates();
        page.getViewById("win").visibility = "visible";
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi1wYWdlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibWFpbi1wYWdlLnRzIl0sIm5hbWVzIjpbInBhZ2VMb2FkZWQiLCJhZGRXYWxsIiwiYWRkQmFsbCIsImFkZFRhcmdldCIsImdyYXZpdHlVcGRhdGUiLCJ3aW4iXSwibWFwcGluZ3MiOiJBQUFBLElBQU8sT0FBTyxXQUFXLHlCQUF5QixDQUFDLENBQUM7QUFFcEQsSUFBTyxVQUFVLFdBQVcsNkJBQTZCLENBQUMsQ0FBQztBQUkzRCxJQUFNLGFBQWEsR0FBRyxLQUFLLEdBQUcsSUFBSSxDQUFDO0FBRW5DLElBQUksSUFBSSxHQUFHLEtBQUssQ0FBQztBQUNqQixJQUFJLFNBQVMsR0FBRyxLQUFLLENBQUM7QUFFdEIsSUFBSSxPQUFPLENBQUM7QUFDWixJQUFJLElBQVUsQ0FBQztBQUNmLG9CQUEyQixJQUFJO0lBQzNCQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNQQSxNQUFNQSxDQUFDQTtJQUNYQSxDQUFDQTtJQUNEQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQTtJQUVaQSxrREFBa0RBO0lBQ2xEQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQTtJQUNuQkEsSUFBSUEsU0FBU0EsR0FBR0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsV0FBV0EsQ0FBQ0EsQ0FBQ0E7SUFDOUNBLElBQUlBLFFBQVFBLEdBQUdBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO0lBRXhDQSxpREFBaURBO0lBQ2pEQSxJQUFJQSxLQUFLQSxHQUFHQSxPQUFPQSxDQUFDQSxFQUFDQSxhQUFhQSxFQUFFQSxJQUFJQSxFQUFDQSxDQUFDQSxDQUFDQTtJQUMzQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsSUFBSUEsRUFBRUE7UUFDN0JBLFNBQVNBLEVBQUVBLFNBQVNBO1FBQ3BCQSxRQUFRQSxFQUFFQSxRQUFRQTtRQUNsQkEsSUFBSUEsRUFBRUEsSUFBSUE7S0FDYkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7SUFFSkEsT0FBT0EsQ0FBQ0EsS0FBS0EsRUFBRUEsQ0FBQ0EsRUFBRUEsR0FBR0EsRUFBRUEsRUFBRUEsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7SUFDaENBLE9BQU9BLENBQUNBLEtBQUtBLEVBQUVBLEdBQUdBLEVBQUVBLEdBQUdBLEVBQUVBLEVBQUVBLEVBQUVBLEdBQUdBLENBQUNBLENBQUNBO0lBQ2xDQSxPQUFPQSxDQUFDQSxLQUFLQSxFQUFFQSxHQUFHQSxFQUFFQSxDQUFDQSxFQUFFQSxHQUFHQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQTtJQUNoQ0EsT0FBT0EsQ0FBQ0EsS0FBS0EsRUFBRUEsR0FBR0EsRUFBRUEsR0FBR0EsRUFBRUEsR0FBR0EsRUFBRUEsRUFBRUEsQ0FBQ0EsQ0FBQ0E7SUFDbENBLE9BQU9BLENBQUNBLEtBQUtBLEVBQUVBLEdBQUdBLEVBQUVBLEdBQUdBLEVBQUVBLEVBQUVBLEVBQUVBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBLFNBQVNBO0lBRTVDQSxTQUFTQSxDQUFDQSxLQUFLQSxFQUFFQSxHQUFHQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFDQTtJQUMzQkEsT0FBT0EsQ0FBQ0EsS0FBS0EsRUFBRUEsRUFBRUEsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7SUFFeEJBLElBQUlBLEtBQUtBLEdBQUdBLE9BQU9BLENBQUNBLEtBQUtBLENBQUNBO1FBQ3RCQSxHQUFHQSxFQUFFQTtZQUNEQSxFQUFFQSxLQUFLQSxFQUFFQSxFQUFFQSxLQUFLQSxFQUFFQSxNQUFNQSxFQUFFQSxFQUFFQSxLQUFLQSxFQUFFQSxFQUFFQSxLQUFLQSxFQUFFQSxRQUFRQSxFQUFFQSxFQUFFQTtZQUN2REEsRUFBRUEsS0FBS0EsRUFBRUEsRUFBRUEsS0FBS0EsRUFBRUEsUUFBUUEsRUFBRUEsRUFBRUEsS0FBS0EsRUFBRUEsRUFBRUEsS0FBS0EsRUFBRUEsTUFBTUEsRUFBRUEs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