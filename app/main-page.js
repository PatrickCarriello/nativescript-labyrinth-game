var Physics = require("nativescript-physics-js");
var accService = require("native-script-accelerometer");
var gravity_scale = 0.003 / 9.81;
var init = false;
var gameEnded = false;
var gravity;
var page;
function pageLoaded(args) {
    if (init) {
        return;
    }
    init = true;
    // Get references to container and meta-info views
    page = args.object;
    var container = page.getViewById("container");
    var metaText = page.getViewById("meta");
    // Create physics world and configure NS renderer
    var world = Physics({ sleepDisabled: true });
    world.add(Physics.renderer('ns', {
        container: container,
        metaText: metaText,
        meta: true
    }));
    world.add(Physics.body('rectangle', { treatment: 'static',
        x: 0,
        y: 150,
        width: 20,
        height: 300,
        styles: { color: "orange" }
    }));
    addWall(world, 0, 150, 20, 300);
    addWall(world, 300, 150, 20, 300);
    addWall(world, 150, 0, 300, 20);
    addWall(world, 150, 300, 300, 20);
    addWall(world, 150, 250, 10, 200); // Middle
    addTarget(world, 225, 225);
    addBall(world, 50, 250);
    var query = Physics.query({
        $or: [
            { bodyA: { label: 'ball' }, bodyB: { label: 'target' } },
            { bodyB: { label: 'target' }, bodyA: { label: 'ball' } }
        ]
    });
    world.on('collisions:detected', function (data, e) {
        // find the first collision that matches the query
        var found = Physics.util.find(data.collisions, query);
        if (found) {
            win(world);
        }
    });
    // Add behaviors
    gravity = Physics.behavior('constant-acceleration', { acc: { x: 0, y: 0 } });
    world.add([
        Physics.behavior('edge-collision-detection', { aabb: Physics.aabb(0, 0, 300, 300) }),
        Physics.behavior('body-collision-detection'),
        Physics.behavior('body-impulse-response'),
        Physics.behavior('sweep-prune'),
        gravity
    ]);
    setTimeout(function () {
        accService.startAccelometerUpdates(gravityUpdate);
    }, 100);
    // Start ticking...
    world.on('step', function () { world.render(); });
    setInterval(function () { world.step(Date.now()); }, 20);
}
exports.pageLoaded = pageLoaded;
function addWall(world, x, y, width, height, angle) {
    if (angle === void 0) { angle = 0; }
    world.add(Physics.body('rectangle', {
        treatment: 'static',
        x: x,
        y: y,
        width: width,
        height: height,
        angle: angle,
        styles: { color: "orange" }
    }));
}
function addBall(world, x, y) {
    var ball = Physics.body('circle', {
        label: "ball",
        x: x,
        y: y,
        radius: 15,
        styles: { image: "~/images/ball.png" }
    });
    ball.restitution = 0.3;
    world.add(ball);
}
function addTarget(world, x, y) {
    world.add(Physics.body('circle', {
        label: "target",
        treatment: 'static',
        x: x,
        y: y,
        radius: 20,
        styles: { image: "~/images/target.png" }
    }));
}
function gravityUpdate(data) {
    //console.log("data: " + JSON.stringify(data));
    var xAcc = -data.x * gravity_scale;
    var yacc = data.y * gravity_scale;
    gravity.setAcceleration({ x: xAcc, y: yacc });
}
function win(world) {
    if (!gameEnded) {
        gameEnded = true;
        world.pause();
        accService.stopAccelometerUpdates();
        page.getViewById("win").visibility = "visible";
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi1wYWdlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsibWFpbi1wYWdlLnRzIl0sIm5hbWVzIjpbInBhZ2VMb2FkZWQiLCJhZGRXYWxsIiwiYWRkQmFsbCIsImFkZFRhcmdldCIsImdyYXZpdHlVcGRhdGUiLCJ3aW4iXSwibWFwcGluZ3MiOiJBQUFBLElBQU8sT0FBTyxXQUFXLHlCQUF5QixDQUFDLENBQUM7QUFFcEQsSUFBTyxVQUFVLFdBQVcsNkJBQTZCLENBQUMsQ0FBQztBQUkzRCxJQUFNLGFBQWEsR0FBRyxLQUFLLEdBQUcsSUFBSSxDQUFDO0FBRW5DLElBQUksSUFBSSxHQUFHLEtBQUssQ0FBQztBQUNqQixJQUFJLFNBQVMsR0FBRyxLQUFLLENBQUM7QUFFdEIsSUFBSSxPQUFPLENBQUM7QUFDWixJQUFJLElBQVUsQ0FBQztBQUNmLG9CQUEyQixJQUFJO0lBQzNCQSxFQUFFQSxDQUFDQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQTtRQUNQQSxNQUFNQSxDQUFDQTtJQUNYQSxDQUFDQTtJQUNEQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQTtJQUVaQSxrREFBa0RBO0lBQ2xEQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxNQUFNQSxDQUFDQTtJQUNuQkEsSUFBSUEsU0FBU0EsR0FBR0EsSUFBSUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsV0FBV0EsQ0FBQ0EsQ0FBQ0E7SUFDOUNBLElBQUlBLFFBQVFBLEdBQUdBLElBQUlBLENBQUNBLFdBQVdBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO0lBRXhDQSxpREFBaURBO0lBQ2pEQSxJQUFJQSxLQUFLQSxHQUFHQSxPQUFPQSxDQUFDQSxFQUFDQSxhQUFhQSxFQUFFQSxJQUFJQSxFQUFDQSxDQUFDQSxDQUFDQTtJQUMzQ0EsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsSUFBSUEsRUFBRUE7UUFDN0JBLFNBQVNBLEVBQUVBLFNBQVNBO1FBQ3BCQSxRQUFRQSxFQUFFQSxRQUFRQTtRQUNsQkEsSUFBSUEsRUFBRUEsSUFBSUE7S0FDYkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7SUFFSkEsS0FBS0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsT0FBT0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsV0FBV0EsRUFBRUEsRUFBRUEsU0FBU0EsRUFBRUEsUUFBUUE7UUFDckRBLENBQUNBLEVBQUVBLENBQUNBO1FBQ0pBLENBQUNBLEVBQUVBLEdBQUdBO1FBQ05BLEtBQUtBLEVBQUVBLEVBQUVBO1FBQ1RBLE1BQU1BLEVBQUVBLEdBQUdBO1FBQ1hBLE1BQU1BLEVBQUVBLEVBQUVBLEtBQUtBLEVBQUVBLFFBQVFBLEVBQUVBO0tBQzlCQSxDQUFDQSxDQUFDQSxDQUFDQTtJQUdKQSxPQUFPQSxDQUFDQSxLQUFLQSxFQUFFQSxDQUFDQSxFQUFFQSxHQUFHQSxFQUFFQSxFQUFFQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFDQTtJQUNoQ0EsT0FBT0EsQ0FBQ0EsS0FBS0EsRUFBRUEsR0FBR0EsRUFBRUEsR0FBR0EsRUFBRUEsRUFBRUEsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0E7SUFDbENBLE9BQU9BLENBQUNBLEtBQUtBLEVBQUVBLEdBQUdBLEVBQUVBLENBQUNBLEVBQUVBLEdBQUdBLEVBQUVBLEVBQUVBLENBQUNBLENBQUNBO0lBQ2hDQSxPQUFPQSxDQUFDQSxLQUFLQSxFQUFFQSxHQUFHQSxFQUFFQSxHQUFHQSxFQUFFQSxHQUFHQSxFQUFFQSxFQUFFQSxDQUFDQSxDQUFDQTtJQUNsQ0EsT0FBT0EsQ0FBQ0EsS0FBS0EsRUFBRUEsR0FBR0EsRUFBRUEsR0FBR0EsRUFBRUEsRUFBRUEsRUFBRUEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsU0FBU0E7SUFFNUNBLFNBQVNBLENBQUNBLEtBQUtBLEVBQUVBLEdBQUdBLEVBQUVBLEdBQUdBLENBQUNBLENBQUNBO0lBQzNCQSxPQUFPQSxDQUFDQSxLQUFLQSxFQUFFQSxFQUFFQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFDQTtJQUV4QkEsSUFBSUEsS0FBS0Es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